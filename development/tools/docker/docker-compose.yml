version: '3.2'
services:
  doener_db:
    image: daily.entwicklung.god.de:5000/doener/develop/doener_db:latest
    networks:
        - internal
    build: 
        context: doener_db
        dockerfile: Dockerfile
  doener_app:
    image: daily.entwicklung.god.de:5000/doener/develop/doener_app:latest
    networks:
        - proxy
        - internal
    build: 
        context: doener_app
        dockerfile: Dockerfile
    secrets:
        - application.yml 
    ports:
        - "8080:8080"
    healthcheck:
        test: ["CMD","nc", "-z", "localhost", "8080"]
        interval: 20s
        timeout: 10s
        retries: 10
    restart: always
secrets:
  application.yml:
    file: ./secrets/application.yml

networks:
  internal:
  proxy:

