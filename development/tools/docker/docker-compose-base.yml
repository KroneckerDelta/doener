version: '3.2'
services:
  doener_db:
    image: daily.entwicklung.god.de:5000/doener/develop/doener_db:latest
    networks:
        - internal
    build: 
        context: doener_db
        dockerfile: Dockerfile
  doener_app:
    environment:
        SPRING_PROFILES_ACTIVE: 'production'  
    image: daily.entwicklung.god.de:5000/doener/develop/doener_app:latest
    networks:
        - proxy
        - internal
    build: 
        context: doener_app
        dockerfile: Dockerfile
    secrets:
        - doener_secret
    ports:
        - "9998:8080"
#    healthcheck:
#        test: 'nc -z localhost 8080'
#        interval: 5s
#        retries: 10
    restart: always
  reposerver:
    image: ${DOCKER_REPO_URL}/godmbh/reposerver

networks:
  internal:
  proxy:  

